{% extends "base.html" %}

{% block title %}TDRMCD - Tribal Districts Resource Management and Community Development{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section bg-primary text-white py-5 position-relative">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">Tribal Districts Resource Management</h1>
                <p class="lead mb-4">
                    Empowering communities in Khyber Pakhtunkhwa through sustainable resource management, 
                    knowledge sharing, and collaborative development initiatives.
                </p>
                <div class="d-flex gap-3 flex-wrap position-relative" style="z-index: 2;">
                    <a href="/resources/" class="btn btn-light btn-lg shadow">
                        <i class="fas fa-gem me-2"></i>Explore Resources
                    </a>
                    <a href="/community/" class="btn btn-outline-light btn-lg shadow">
                        <i class="fas fa-users me-2"></i>Join Community
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="hero-bubbles" aria-hidden="true"></div>
</section>

<!-- Statistics Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <i class="fas fa-gem fa-3x text-primary mb-3"></i>
                    <h3 class="fw-bold" data-counter data-target="{{ total_resources }}">0</h3>
                    <p class="text-muted">Resources Documented</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <i class="fas fa-users fa-3x text-success mb-3"></i>
                    <h3 class="fw-bold" data-counter data-target="{{ total_members }}">0</h3>
                    <p class="text-muted">Community Members</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <i class="fas fa-comments fa-3x text-info mb-3"></i>
                    <h3 class="fw-bold" data-counter data-target="{{ active_discussions }}">0</h3>
                    <p class="text-muted">Active Discussions</p>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-4">
                <div class="stat-card">
                    <i class="fas fa-bullhorn fa-3x text-warning mb-3"></i>
                    <h3 class="fw-bold" data-counter data-target="{{ active_campaigns_count }}">0</h3>
                    <p class="text-muted">Active Campaigns</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Resources Section -->
<section class="py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 class="fw-bold">Featured Resources</h2>
                <p class="text-muted">Discover the rich natural and cultural heritage of tribal districts</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{{ url_for('resources.index') }}" class="btn btn-primary">
                    View All Resources <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
        
        <div class="row reveal-on-scroll">
            {% for resource in featured_resources %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card resource-card h-100 shadow-sm">
                    {% if resource.image_url %}
                    <img src="{{ url_for('serve_uploaded_file', subdir='resources', filename=resource.image_url.split('/')[-1]) }}" 
                         class="card-img-top" alt="{{ resource.title }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                        <i class="fas fa-image fa-3x text-muted"></i>
                    </div>
                    {% endif %}
                    
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge bg-primary">{{ resource.category.title() }}</span>
                            {% if resource.location %}
                            <small class="text-muted">
                                <i class="fas fa-map-marker-alt me-1"></i>{{ resource.location }}
                            </small>
                            {% endif %}
                        </div>
                        
                        <h5 class="card-title">{{ resource.title }}</h5>
                        <p class="card-text text-muted">
                            {{ resource.description[:100] }}{% if resource.description|length > 100 %}...{% endif %}
                        </p>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                By {{ resource.author.get_full_name() }}
                            </small>
                            <a href="{{ url_for('resources.detail', id=resource.id) }}" class="btn btn-sm btn-outline-primary">
                                Learn More
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Community Activity Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <h2 class="fw-bold mb-4">Recent Community Activity</h2>
                
                <div class="activity-feed reveal-on-scroll">
                    {% for post in recent_posts %}
                    <div class="activity-item border-bottom pb-3 mb-3">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    {{ post.author.first_name[0] }}{{ post.author.last_name[0] }}
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">
                                            <a href="{{ url_for('community.post_detail', id=post.id) }}" class="text-decoration-none">
                                                {{ post.title }}
                                            </a>
                                        </h6>
                                        <p class="mb-1 text-muted small">
                                            {{ post.content[:100] }}{% if post.content|length > 100 %}...{% endif %}
                                        </p>
                                    </div>
                                    <span class="badge bg-secondary">{{ post.category.title() }}</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        By {{ post.author.get_full_name() }} â€¢ {{ post.created_at.strftime('%B %d, %Y') }}
                                    </small>
                                    <div class="d-flex gap-2">
                                        <small class="text-muted">
                                            <i class="fas fa-heart me-1"></i>{{ post.likes }}
                                        </small>
                                        <small class="text-muted">
                                            <i class="fas fa-eye me-1"></i>{{ post.views }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="text-center">
                    <a href="{{ url_for('community.index') }}" class="btn btn-primary">
                        View All Discussions <i class="fas fa-arrow-right ms-2"></i>
                    </a>
                </div>
            </div>
            
            <div class="col-lg-4">
                <h4 class="fw-bold mb-4">Active Campaigns</h4>
                
                {% for campaign in active_campaigns %}
                <div class="card campaign-card mb-3 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge bg-{{ 'success' if campaign.campaign_type == 'health' else 'info' if campaign.campaign_type == 'education' else 'warning' }}">
                                {{ campaign.campaign_type.title() }}
                            </span>
                            <small class="text-muted">
                                {{ campaign.created_at.strftime('%b %d') }}
                            </small>
                        </div>
                        
                        <h6 class="card-title">{{ campaign.title }}</h6>
                        <p class="card-text small text-muted">
                            {{ campaign.description[:80] }}{% if campaign.description|length > 80 %}...{% endif %}
                        </p>
                        
                        <a href="{{ url_for('main.campaign_detail', campaign_id=campaign.id) }}" class="btn btn-sm btn-outline-primary">Learn More</a>
                    </div>
                </div>
                {% endfor %}
                
                <div class="text-center">
                    <a href="{{ url_for('main.campaigns_by_type', campaign_type='invalid') }}" class="btn btn-sm btn-primary">View All Campaigns</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action Section -->
<section class="py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="fw-bold mb-2">Ready to Contribute?</h3>
                <p class="mb-0">Join our community and help document and preserve the rich heritage of tribal districts.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                {% if not current_user.is_authenticated %}
                <a href="{{ url_for('auth.register') }}" class="btn btn-light btn-lg">
                    <i class="fas fa-user-plus me-2"></i>Join Now
                </a>
                {% else %}
                <a href="{{ url_for('resources.add') }}" class="btn btn-light btn-lg">
                    <i class="fas fa-plus me-2"></i>Add Resource
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.hero-section {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
}

.hero-wave {
    pointer-events: none;
}

.float-animation {
    animation: floatY 6s ease-in-out infinite;
}

@keyframes floatY {
    0% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
    100% { transform: translateY(0); }
}

.stat-card {
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.resource-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.resource-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.campaign-card {
    border-left: 4px solid var(--bs-primary);
}

.activity-item:hover {
    background-color: rgba(0, 123, 255, 0.05);
    border-radius: 0.375rem;
    margin: -0.5rem;
    padding: 0.5rem !important;
}

.reveal-on-scroll .card,
.reveal-on-scroll .activity-item {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity .6s ease, transform .6s ease;
}

.reveal-on-scroll .card.is-visible,
.reveal-on-scroll .activity-item.is-visible {
    opacity: 1;
    transform: translateY(0);
}

/* Floating bubbles/hearts */
.hero-bubbles {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 0;
    pointer-events: none;
    z-index: 0;
}

.hero-bubbles .bubble-wrap {
    position: absolute;
    bottom: 0;
    left: var(--left, 50%);
    transform: translateX(-50%);
    animation: rise var(--dur, 7s) linear forwards;
}

.hero-bubbles .bubble {
    position: relative;
    color: hsla(var(--hue, 0), 90%, 95%, 0.95);
    font-weight: 700;
    white-space: nowrap;
    text-shadow: 0 2px 6px rgba(0,0,0,0.25);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    animation: wobble var(--wob, 3s) ease-in-out infinite;
    transform: rotate(var(--rot, 0deg));
}

@keyframes rise {
    0% { transform: translate(-50%, 0) translateX(0) scale(0.9); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translate(-50%, -340px) translateX(var(--drift, 0px)) scale(1.05); opacity: 0; }
}

@keyframes wobble {
    0% { transform: rotate(var(--rot, 0deg)) translateX(0); }
    50% { transform: rotate(var(--rot, 0deg)) translateX(6px); }
    100% { transform: rotate(var(--rot, 0deg)) translateX(0); }
}

@media (prefers-reduced-motion: reduce) {
    .hero-bubbles .bubble-wrap { animation: none; }
    .hero-bubbles .bubble { animation: none; }
}

.avatar {
    font-weight: 600;
    font-size: 0.875rem;
}
</style>
{% endblock %}
